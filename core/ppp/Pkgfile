# Description: The PPP (Point-to-Point Protocol) daemon.
# URL: http://www.samba.org/ppp/
# Maintainer: Danny Rawlins, monster dot romster at gmail dot com
# Packager: CRUX System Team, core-ports at crux dot nu
# Depends on: zlib openssl

name=ppp
version=2.4.4
release=2
source=(http://$name.samba.org/ftp/$name/$name-$version.tar.gz
	$name-nofilter.patch
	$name-makefile.patch
	$name-$version-linkpidfile.patch
	$name-$version-pppoe-lcp-timeout.patch
	$name-$version-new-valid-speeds.patch
	$name-$version-make-var.patch)

build() {
	cd $name-$version
	patch -p 1 -i $SRC/$name-nofilter.patch
	patch -p 1 -i $SRC/$name-makefile.patch
	patch -p 1 -i $SRC/$name-$version-linkpidfile.patch
	patch -p 1 -i $SRC/$name-$version-pppoe-lcp-timeout.patch
	patch -p 1 -i $SRC/$name-$version-new-valid-speeds.patch
	patch -p 1 -i $SRC/$name-$version-make-var.patch
	find $SRC -name 'Makefile.linux' -exec sed -i -e 's|/share/man/|/man/|' {} \;

	# configure is a shell script
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc

	export CC='gcc'
	export AR='ar'
	export LDFLAGS+='-Wl,--allow-shlib-undefined' # otherwise linking plugins might fail with undef errors

	make COPTS="${CFLAGS} -D_GNU_SOURCE"
	make INSTROOT=$PKG install install-etcppp
	rmdir $PKG/usr/share/man/man8
	rmdir $PKG/usr/share/man
	rmdir $PKG/usr/share
	chmod +w -R $PKG
}

