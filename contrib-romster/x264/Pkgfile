# Description: Library for encoding H264/AVC video streams (snapshot).
# URL: http://developers.videolan.org/x264.html
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Rouven Schuerch, rs at tegonal dot com
# Depends on: lzma

name=x264
version=r745
release=1
source=(http://romster.shortcircuit.net.au/crux/source/x264/x264-snapshot-$version.tar.lzma)

build() {
	# temp fix untill/if pkgutils supports lzma
	if [ -e $SRC/$name-snapshot-$version.tar.lzma ]; then
		tar --use-compress-program=lzma -xf $name-snapshot-$version.tar.lzma
		rm $name-snapshot-$version.tar.lzma
	fi

	cd x264
	export CFLAGS="$(echo $CFLAGS |sed -e 's/-O[s0-3] //')"

	sed -i \
		-e 's/-O4/-O3/' \
		-e 's|-I/usr/X11R6/include|-I/usr/X11/include|' configure

	./configure \
		--prefix=/usr \
		--enable-pic \
		--enable-pthread \
		--enable-shared

	make
	make DESTDIR=$PKG install
}

