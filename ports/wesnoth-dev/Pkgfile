# Description: The Battle for Wesnoth is a turn-based strategy game with a fantasy theme (development branch).
# URL: http://www.wesnoth.org/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Danny Rawlins, romster at shortcircuit dot net dot au
# Depends on: xorg-libx11 sdl_image sdl_mixer sdl_net freetype python
# Optional: upx

name=wesnoth-dev
version=1.3.13
release=1
source=(http://dl.sourceforge.net/sourceforge/wesnoth/wesnoth-$version.tar.bz2)

build() {
	cd wesnoth-$version

		if pkginfo -i |grep '^kdebase ' > /dev/null; then
			local configure='--with-kde'
		fi

		if pkginfo -i |grep '^kdebase3 ' > /dev/null; then
			local configure='--with-kde'
		fi

		if pkginfo -i |grep '^gnome ' > /dev/null; then
			local configure='--with-gnome'
		fi

	./configure \
		--prefix=/usr \
		--mandir=/usr/man \
		--program-suffix=-dev \
		--with-datadir-name=wesnoth-dev \
		--with-preferences-dir=.wesnoth-dev \
		--disable-nls \
		--enable-python \
		$configure

	make
	make DESTDIR=$PKG install-strip

	find $PKG/usr/man -maxdepth 0 -type d ! -regex 'man?' -exec rm -r {} \;

	rm \
		$PKG/usr/share/wesnoth-dev/data/COPYING.txt \
		$PKG/usr/share/wesnoth-dev/fonts/COPYING

	if pkginfo -i |grep '^wesnoth '; then
			rm $PKG/usr/share/icons/wesnoth-icon.png
	fi

	# compress binary files if upx is installed to save disk space
	if pkginfo -i |grep '^upx ' > /dev/null; then
		(
			cd $PKG/usr/bin
			upx -9 wesnoth-dev
		)
	fi
}

