# Description: A safe, concurrent, practical language by Mozilla.
# URL: http://www.rust-lang.org/
# Packager: Danny Rawlins, crux at romster dot me
# Maintainer: Danny Rawlins, crux at romster dot me
# Depends on: git libffi python curl
 
name=rust
version=git
#version=git-3da5a5c
#sversion=3da5a5cd18dc2a2177160772725946c3b4512f7c
release=1
source=()
 
build() {
	cd $PKGMK_SOURCE_DIR
 
	if cd $name; then
		git pull --rebase https://github.com/rust-lang/rust.git master
		git checkout $sversion
	else
		git clone https://github.com/rust-lang/rust.git ${name}
		#cd $name
		#git checkout $sversion
	fi

	cd $PKGMK_SOURCE_DIR

	for sname in compiler-rt gyp jemalloc libuv llvm hoedown; do
		if cd ${sname}; then
			git pull --rebase https://github.com/rust-lang/${sname}.git master
		else
			git clone https://github.com/rust-lang/${sname}.git ${sname}
		fi
		cd $PKGMK_SOURCE_DIR
	done

	cp -r $PKGMK_SOURCE_DIR/$name $SRC

	for sname in compiler-rt gyp jemalloc libuv llvm; do
		cp -r $PKGMK_SOURCE_DIR/${sname} $SRC/$name/src/
	done

	#install -d $SRC/$name/src/rt
	#cp -r $PKGMK_SOURCE_DIR/hoedown $SRC/$name/src/rt/hoedown

	cd $SRC/$name
 
	./configure \
		--prefix=/usr \
		--mandir=/usr/man \
		--disable-docs \
		--enable-ccache

	make
	make DESTDIR=$PKG install

	install --directory $PKG/usr/share/vim
	cp -a src/etc/vim/* $PKG/usr/share/vim
}
