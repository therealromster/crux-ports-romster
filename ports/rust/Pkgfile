# Description: A safe, concurrent, practical language by Mozilla.
# URL: http://www.rust-lang.org/
# Packager: Danny Rawlins, crux at romster dot me
# Maintainer: Danny Rawlins, crux at romster dot me
# Depends on: llvm

name=rust
version=1.21.0
release=1
source=(https://static.rust-lang.org/dist/${name}c-$version-src.tar.gz
	0001-librustc_llvm-build-Force-link-against-libffi.patch
	bootstrap-config.toml)
 
build() {
	cd ${name}c-$version-src

	patch -p1 -i $SRC/0001-librustc_llvm-build-Force-link-against-libffi.patch
	cp $SRC/bootstrap-config.toml config.toml

	/usr/bin/python ./x.py build --verbose
	DESTDIR=$PKG /usr/bin/python ./x.py install

	rm -r $PKG/usr/share/doc

	cd $PKG/usr/lib
	rm rustlib/{components,manifest-rustc,rust-installer-version}
	ln -sf rustlib/x86_64-unknown-linux-gnu/lib/*.so .
}
