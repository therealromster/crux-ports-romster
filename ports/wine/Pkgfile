# Description: Wine - Implementation of Windows DLL's and core.
# URL: http://www.winehq.com/
# Maintainer: Danny Rawlins, monster dot romster at gmail dot com
# Packager: Daniel Walpole, daniel at walpole dot id dot au
# Depends on: fontforge

name=wine
version=1.3.34
release=1
source=(http://downloads.sourceforge.net/$name/$name-$version.tar.bz2
	http://nogagplz.doesntexist.org/kdebits/wine-kane_1.3.30.patch
	http://www.compholio.com/wine-kane/download.php?file=0001-ntdll-Pass-ReadFile-and-WriteFile-requests-on-socket.patch
	http://www.compholio.com/wine-kane/download.php?file=0002-ws2_32-tests-Add-UDP-broadcast-tests.patch
	http://www.compholio.com/wine-kane/download.php?file=0003-server-Add-mechanism-for-storing-an-interface-ID-wit.patch
	http://www.compholio.com/wine-kane/download.php?file=0004-ws2_32-Selectively-bind-UDP-sockets-to-interfaces-wh.patch
	http://www.compholio.com/wine-kane/download.php?file=0005-server-ws2_32-Support-UDP-binding-of-interfaces-on-s.patch)
up2date_url="http://ibiblio.org/pub/linux/system/emulators/$name/"

build() {
	cd $name-$version

	# The Kane Edition is a special build of the popular Wine software with patches to make
	# Command & Conquer 3: Kane's Wrath work out of the box.
	mv $SRC/download.php?file=0001-ntdll-Pass-ReadFile-and-WriteFile-requests-on-socket.patch \
		$SRC/0001-ntdll-Pass-ReadFile-and-WriteFile-requests-on-socket.patch
	mv $SRC/download.php?file=0002-ws2_32-tests-Add-UDP-broadcast-tests.patch \
		$SRC/0002-ws2_32-tests-Add-UDP-broadcast-tests.patch
	mv $SRC/download.php?file=0003-server-Add-mechanism-for-storing-an-interface-ID-wit.patch \
		$SRC/0003-server-Add-mechanism-for-storing-an-interface-ID-wit.patch
	mv $SRC/download.php?file=0004-ws2_32-Selectively-bind-UDP-sockets-to-interfaces-wh.patch \
		$SRC/0004-ws2_32-Selectively-bind-UDP-sockets-to-interfaces-wh.patch
	mv $SRC/download.php?file=0005-server-ws2_32-Support-UDP-binding-of-interfaces-on-s.patch \
		$SRC/0005-server-ws2_32-Support-UDP-binding-of-interfaces-on-s.patch

	# some patches wont apply after wine version 1.3.30
	#patch -p 1 -i $SRC/0001-ntdll-Pass-ReadFile-and-WriteFile-requests-on-socket.patch
	#patch -p 1 -i $SRC/0002-ws2_32-tests-Add-UDP-broadcast-tests.patch
	#patch -p 1 -i $SRC/0003-server-Add-mechanism-for-storing-an-interface-ID-wit.patch
	#patch -p 1 -i $SRC/0004-ws2_32-Selectively-bind-UDP-sockets-to-interfaces-wh.patch
	#patch -p 1 -i $SRC/0005-server-ws2_32-Support-UDP-binding-of-interfaces-on-s.patch

	patch -p 1 -i $SRC/wine-kane_1.3.30.patch

	./configure \
		--verbose \
		--prefix=/usr \
		--mandir=/usr/man \
		--disable-tests

	make depend
	make
	make DESTDIR=$PKG install
	rm -r $PKG/usr/man/??.UTF-8
}
