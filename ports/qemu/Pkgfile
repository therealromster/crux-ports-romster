# Description: Is a generic and open source machine emulator and virtualizer.
# URL: http://fabrice.bellard.free.fr/qemu/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Antonio SJ Musumeci
# Depends on: libsdl gcc34

name=qemu
version=0.9.1
release=1
source=(http://fabrice.bellard.free.fr/qemu/qemu-$version.tar.gz \
	70-kqemu.rules)

build() {
	unset CFLAGS
	cd qemu-$version

	# don't use distcc as it wont compile but use ccache if installed
	if pkginfo -i |grep '^distcc ' > /dev/null; then
		if pkginfo -i |grep '^ccache ' > /dev/null; then
			if [ $CCACHE_PREFIX = distcc ]; then
				unset CCACHE_PREFIX
			fi
		else
			export PATH="$(echo $PATH |sed -e 's|/usr/lib/distcc:||')"
		fi
	fi

	./configure \
		--prefix=/usr \
		--enable-alsa

	make
	make DESTDIR=$PKG install
	install -D -m 0644 $SRC/70-kqemu.rules $PKG/etc/udev/rules.d/70-kqemu.rules
}

