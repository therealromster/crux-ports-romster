# $Id: 
# Description: MinGW32 binutils.
# URL: http://www.mingw.org/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Danny Rawlins, <romster@shortcircuit.net.au>
# Depends on: texinfo, mingw32-runtime

name=mingw32-binutils
version=2.17.50-20060824
release=1
PORT_TARGET=mingw32
source=(http://dl.sourceforge.net/sourceforge/mingw/binutils-$version-$release-src.tar.gz)

build() {
	install -d \
		$SRC/build \
		"$PKG/usr/share/$PORT_TARGET/bin"

	cd $SRC/build

	../binutils-$version-$release-src/configure \
		--prefix=/usr \
		--target="$PORT_TARGET" \
		--disable-nls \
		--disable-shared \
		--with-gcc \
		--with-gnu-as \
		--with-gnu-ld
		
	make CFLAGS="-O2 -fno-exceptions" LDFLAGS="-s"
	make DESTDIR=$PKG install
	ln -fs "/usr/share/$PORT_TARGET/bin/objdump" "$PKG/usr/bin/$PORT_TARGET-objdump"

	rm -fr \
		$PKG/usr/info \
		$PKG/usr/lib/libiberty.a \
		"$PKG/usr/$PORT_TARGET/sys-include"

	find $PKG/ -type f -regex '.dll$' -regex 'debug$' -exec strip {} \;
	chown -R root:root $PKG
}

