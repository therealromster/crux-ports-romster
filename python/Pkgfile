# $Id:
# Description: Python interpreter.
# URL: http://www.python.org
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Jürgen Daubert, juergen dot daubert at t-online dot de
# Depends on: db, gdbm, ncurses, openssl, readline, zlib

# Recommended:	
# Optional:	
# Category:	interpreter, python

name=python
version=2.5
release=1
source=(http://www.python.org/ftp/python/$version/Python-$version.tar.bz2)

build() {
	cd Python-$version
   
	# edit Modules/Setup.dist to make shared librarys and
	# include readline library
	sed -i \
		-e 's|^#\*shared\*$|*shared*|' \
		-e 's|^\#dbm dbmmodule.c 	\# dbm\(3\) may require \-lndbm or similar$|dbm dbmmodule.c -DHAVE_NDBM_H -lgdbm_compat -lgdbm	# dbm(3) may require -lndbm or similar|' Modules/Setup.dist

	sed -i -e 's|OPT="-g -O3 -Wall $STRICT_PROTO"|OPT="$CFLAGS -Wall $STRICT_PROTO"|' configure
    
	./configure \
		--prefix=/usr \
		--enable-shared \
		--with-threads \
		--enable-ipv6 \
		--with-cxx-main=gcc

	make && make DESTDIR=$PKG install
	ln -fs $name$version $PKG/usr/bin/$name
	ln -fs $name$version $PKG/usr/lib/$name
	ln -fs $name$version $PKG/usr/include/$name
    
	rm -r \
		$PKG/usr/lib/python/{email,bsddb}/test \
		$PKG/usr/lib/python/distutils/tests

	rm \
		$PKG/usr/lib/python/{distutils,site-packages,test}/README \
		$PKG/usr/lib/python/idlelib/{ChangeLog,{NEWS,README,TODO}.txt} \
		$PKG/usr/lib/python2.5/ctypes/macholib/README.ctypes

	chown -R root:root $PKG
}

