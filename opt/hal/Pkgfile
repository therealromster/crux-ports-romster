# Description: Hardware Abstraction Layer.
# URL: http://www.freedesktop.org/wiki/Software/hal
# Packager: Matt Housh, jaeger at crux dot nu
# Maintainer: Danny Rawlins, monster dot romster at gmail dot com
# Depends on: dbus-glib expat libusb glib dbus udev eject pciutils

name=hal
version=0.5.11
release=9
up2date="lynx -dump 'http://hal.freedesktop.org/releases/?C=M;O=A' |grep '.tar.bz2' |grep -v 'hal-info'|grep -v 'gnome'|grep -v PolicyKit |sed -ne 's/.*$name-\(.*\)\.t.*/\1/' -e '$ p'"
source=(http://hal.freedesktop.org/releases/$name-$version.tar.gz
	hal-0.5.11-udev-info.patch
	hal.conf
	rc.hald
	$name-configure.patch
	suspend_hibernate.patch)

build() {
	cd $name-$version

	patch -p 1 -i $SRC/$name-configure.patch
	patch -p 1 -i $SRC/suspend_hibernate.patch
	patch -p 1 -i $SRC/$name-0.5.11-udev-info.patch

	aclocal
	autoheader
	autoconf
	libtoolize --force --automake
	automake -a --gnu --include-deps

	sed -i \
		-e 's/USE_NLS=yes/USE_NLS=no/' \
		-e 's/ENABLE_NLS 1/ENABLE_NLS 0/' configure

	./configure \
		--prefix=/usr \
		--mandir=/usr/man \
		--libexecdir=/usr/lib/$name \
		--localstatedir=/var \
		--with-dbus-sys=/usr/etc/dbus-1/system.d \
		--with-hwdata=/usr/share \
		--with-hal-user=haldaemon \
		--with-hal-group=haldaemon \
		--with-backend=linux \
		--with-os-type=CRUX \
		--enable-man-pages \
		--disable-gtk-doc \
		--disable-docbook-doc \
		--disable-policy-kit \
		--disable-console-kit \
		--disable-static \
		--disable-dependency-tracking

	sed -i -e '/device-manager/d' tools/Makefile

	make
	make DESTDIR=$PKG install

	install -d $PKG/lib/udev/rules.d
	mv $PKG/usr/etc/udev/rules.d $PKG/lib/udev/rules.d
	install -m 0755 -D $SRC/rc.hald  $PKG/etc/rc.d/hald
	install -m 0644    $SRC/hal.conf $PKG/usr/etc/dbus-1/system.d/
	install -d -o haldaemon -g haldaemon $PKG/var/lib/hal

	rm -r $PKG/usr/share/gtk-doc
	rmdir $PKG/usr/etc/udev
}

