# Description: Versatile media player and encoder/converter.
# URL: http://www.mplayerhq.hu/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Matt Housh, jaeger at morpheus dot net
# Depends on: expat xorg-libxinerama xorg-libxv xorg-libxxf86dga xorg-libxxf86vm
# Optional: upx libsdl libjpeg libpng lame zlib libogg libvorbis cdparanoia win32-essential-codecs faac x264

#More information can be found at http://www.mplayerhq.hu/DOCS/codecs.html and
#http://www.mplayerhq.hu/DOCS/HTML/en/index.html

name=mplayer
version=1.0rc1
release=1
source=(http://www1.mplayerhq.hu/MPlayer/releases/MPlayer-$version.tar.bz2 \
	http://www1.mplayerhq.hu/MPlayer/releases/fonts/font-arial-iso-8859-1.tar.bz2 \
	mplayer.conf)

build() {
	cd MPlayer-$version

	# mplayer decides optimizations at configure time, don't use CRUX's
	unset CFLAGS CXXFLAGS
	sed -i -e 's/-O4/-O3/' configure

	./configure \
		--prefix=/usr \
		--mandir=/usr/man \
		--enable-largefiles \
		--disable-ossaudio \
		--enable-dynamic-plugins
		#--win32codecsdir=/usr/lib/win32 done by default needed for rc2 only which is broken

	make
	make DESTDIR=$PKG install

	(
		cd $PKG/usr/man/man1
		rm mencoder.1
		ln -s mplayer.1.gz mencoder.1.gz
	)

	# fonts
	install -d $PKG/usr/share/mplayer/font

	cp -a $SRC/font-arial-iso-8859-1/font-arial-??-iso-8859-1 $PKG/usr/share/mplayer/font/
	chmod 0644 $PKG/usr/share/mplayer/font/font-arial-??-iso-8859-1/*

	(
		cd $PKG/usr/share/mplayer/font
		for i in font-arial-14-iso-8859-1/*; do
			ln -s $i
		done
	)

	# config
	install -m 0644 $SRC/mplayer.conf etc/input.conf -t $PKG/usr/etc/mplayer/

	# compress binarys if upx is installed to save disk space
	if pkginfo -i |grep '^upx ' > /dev/null; then
		(
			cd $PKG/usr/bin
			upx -9 mencoder mplayer
		)
	fi

}

