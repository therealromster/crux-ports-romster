# Description: Linux GLX port of the Really Slick Screensavers.
# URL: http://rss-glx.sourceforge.net/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Matt Housh, jaeger at morpheus dot net
# Depends on: xscreensaver
# Optional: upx

name=rss-glx
version=0.8.1
release=1
source=(http://dl.sourceforge.net/rss-glx/rss-glx_$version.tar.bz2)

build() {
	cd rss-glx_$version

	./configure \
		--prefix=/usr \
		--with-configdir=/usr/share/xscreensaver/config \
		--disable-sound

	make
	make DESTDIR=$PKG install
	install -d $PKG/usr/lib/xscreensaver
	install -d $PKG/usr/sbin
	mv $PKG/usr/bin/rss-glx_install.pl $PKG/usr/sbin/rss-glx_install
	
	(
		cd $PKG/usr/lib/xscreensaver
		for i in $PKG/usr/bin/*; do
			ln -s /usr/bin/$(basename $i)
		done
	)

	rm $PKG/usr/share/applnk/System/ScreenSavers/*.desktop
	rmdir $PKG/usr/share/applnk/System/ScreenSavers
	rmdir $PKG/usr/share/applnk/System
	rmdir $PKG/usr/share/applnk
	
	# compress binary files if upx is installed to save disk space
	if pkginfo -i |grep '^upx ' > /dev/null; then
		(
			cd $PKG/usr/bin
			upx -9 $(find . -type f ! -name rss-glx_install \
				! -name skyrocket ! -name lattice ! -name matrixview \
				! -name hufo_tunnel |xargs)
		)
	fi
}

