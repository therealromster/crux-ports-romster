# $Id:
# URL:		http://gcc.gnu.org/fortran
# Description:	Fortran (f95) add-on for GNU GCC compiler.
# Maintainer:	Danny Rawlins, <romster@shortcircuit.net.au>
# Packager:	acrux, acrux at linuxmail dot org
# Depends on:	libgmp, libmpfr

name=gcc-fortran
version=4.0.3
release=1
source=(ftp://sources.redhat.com/pub/gcc/releases/gcc-$version/gcc-{core,fortran}-$version.tar.bz2 \
	gcc-$version-version.patch)

build() {
    patch -d gcc-$version -p1 -i $SRC/gcc-$version-version.patch
    cd gcc-$version 
    install -d build
    cd build

	../configure \
		--prefix=/usr \
		--libexecdir=/usr/lib \
		--enable-languages=f95 \
		--enable-threads=posix \
		--enable-__cxa_atexit \
		--enable-clocale=gnu \
		--enable-shared \
		--disable-nls \
		--with-x=no

	make bootstrap
	#make check
	make DESTDIR=$PKG install

	ln -s gfortran $PKG/usr/bin/f90
	ln -s gfortran $PKG/usr/bin/f95

	# remove files already on the system out of the port
	rm -r $PKG/usr/info

	for i in `find $PKG | sed -e "s|$PKG|/|"`; do
		if [ -e "$i" ] && [ ! -d "$i" ] ; then
			rm $PKG/$i
		fi
	done

	# Remove empty directories
	find $PKG -depth -empty -exec rm -rf {} \;

	chown -R root:root $PKG
}

