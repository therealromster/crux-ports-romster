# Description: P2P application for web searching.
# URL: http://www.yacy.net/yacy/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Danny Rawlins, romster at shortcircuit dot net dot au
# Depends on: ant

name=yacy
version=0.55_20071004_4145
release=1
source=(http://www.yacy.net/release/yacy_v$version.tar.gz \
	yacy-start.sh yacy-stop.sh yacy.rc)

build() {
	cd yacy

	# ant wont build without this directory.
	mkdir -p $SRC/yacy/libx
	
	# compile
	ant

	# remove un-needed files
	find $SRC/yacy -type f \
		-name '*.bat' -delete -or \
		-name '*.txt' -delete -or \
		-name '*.css.old' -delete -or \
		-name '*.readme' -delete

	rm -r \
		source \
		htroot/locale \
		locales
		#classes/de
		#RELEASE/EXT/{source,classes}/de
	
	rm \
		build.xml \
		htroot/CacheAdmin_p.java.ThomasBockig \
		htroot/.nbattrs

	# install
	install -d $PKG/usr/share/yacy
	cp -R * $PKG/usr/share/yacy/

	# add some protection by limitng what and who can access the p2p files.
	chown -R _yacy:daemon $PKG/usr/share/yacy
	
	install -D -m 0755 $SRC/yacy-start.sh $PKG/usr/sbin/yacy-start
	install -D -m 0755 $SRC/yacy-stop.sh $PKG/usr/sbin/yacy-stop
	install -D -m 0755 $SRC/yacy.rc $PKG/etc/rc.d/yacy
}

