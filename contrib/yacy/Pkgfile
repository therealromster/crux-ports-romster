# Description: P2P application for web searching.
# URL: http://www.yacy.net/yacy/
# Maintainer: Danny Rawlins, romster at shortcircuit dot net dot au
# Packager: Danny Rawlins, romster at shortcircuit dot net dot au
# Depends on: ant

name=yacy
version=0.50_20061223_3132
release=1
source=(http://www.yacy.net/yacy/release/yacy_v$version.tar.gz \
	http://www.yacy.net/superseed.txt \
	$name-start.sh $name-stop.sh $name.rc)

mirror=(http://download.berlios.de/yacy/yacy_v$version.tar.gz)

build() {
	cd yacy

	# ant wont build without this directory.
	mkdir -p $SRC/yacy/libx
	
	# compile
	ant

	# remove un-needed files
	find $SRC/yacy -type f \
		-name '*.bat' -delete -or \
		-name '*.txt' -delete -or \
		-name '*.css.old' -delete -or \
		-name '*.readme' -delete

	rm -r \
		source \
		htroot/locale \
		locales
		#classes/de
		#RELEASE/EXT/{source,classes}/de
	
	rm \
		build.xml \
		htroot/CacheAdmin_p.java.ThomasBockig \
		htroot/.nbattrs

	# install
	install -D $SRC/superseed.txt $PKG/usr/share/yacy/superseed.txt
	cp -R * $PKG/usr/share/yacy/

	# add some protection by limitng what and who can access the p2p files.
	chown -R _yacy:daemon $PKG/usr/share/yacy
	
	install -D -m755 -oroot -groot $SRC/yacy-start.sh $PKG/usr/sbin/yacy-start
	install -D -m755 -oroot -groot $SRC/yacy-stop.sh $PKG/usr/sbin/yacy-stop
	install -D -m755 -oroot -groot $SRC/yacy.rc $PKG/etc/rc.d/yacy
}

